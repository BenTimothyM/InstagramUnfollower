"use strict";const INSTAGRAM_HOSTNAME="www.instagram.com";let nonFollowersList=[],userIdsToUnfollow=[],isActiveProcess=!1;function sleep(e){return new Promise((t=>{setTimeout(t,e)}))}function getCookie(e){const t=("; "+document.cookie).split(`; ${e}=`);if(2===t.length)return t.pop().split(";").shift()}function afterUrlGenerator(e){return`https://www.instagram.com/graphql/query/?query_hash=3dec7e2c57367ef3da3d987d89f9dbc8&variables={"id":"${getCookie("ds_user_id")}","include_reel":"true","fetch_mutual":"false","first":"24","after":"${e}"}`}function unfollowUserUrlGenerator(e){return`https://www.instagram.com/web/friendships/${e}/unfollow/`}function getElementByClass(e){var t=document.querySelector(e);if(null===t)throw new Error("Unable to find element by class. className: "+e);return t}function getUserById(e){var t=nonFollowersList.find((t=>t.id.toString()===e.toString()));return void 0===t&&console.error("Unable to find user by id. userId: "+e),t}function onToggleUser(){getElementByClass(".iu_selected-count").innerHTML=`[${userIdsToUnfollow.length}]`}function renderResults(e){const t=[...e].sort(((e,t)=>e.username>t.username?1:-1)),n=(getElementByClass(".iu_toggle-all-checkbox").disabled=!1,getElementByClass(".iu_results-container"));let o=n.innerHTML="";t.forEach((e=>{var t=e.username.substring(0,1).toUpperCase();o!==t&&(o=t,n.innerHTML+=`<div style='margin:1rem;padding:1rem;font-size:2em;border-bottom: 1px solid #333;'>${o}</div>`),n.innerHTML+=`<label style='display:flex;align-items:center;padding:1rem;border-radius:3px;cursor:pointer;'>            <div style='display:flex;align-items:center;flex:1;'>                <img src=${e.profile_pic_url} width='75px' style='border-radius:50%;' />&nbsp;&nbsp;&nbsp;&nbsp;                <div style='display:flex;flex-direction:column;'>                    <span style='font-size:1.7em;'>${e.username}</span>                    <span style='font-size:0.8em;'>${e.full_name}</span>                </div>                ${e.is_verified?"&nbsp;&nbsp;&nbsp;<div style='background-color:#49adf4;border-radius:50%;padding:0.2rem 0.3rem;font-size:0.35em;height:fit-content;'>âœ”</div>":""}                ${e.is_private?'<div style="display:flex;width:100%;justify-content:space-around;">                            <span style="border: 2px solid #51bb42;border-radius:25px;padding:0.5rem;color:#51bb42;font-weight:500;">Private</span>                          </div>':""}            </div>            <input class='account-checkbox' type='checkbox' style='height:1.1rem;width:1.1rem;' onchange='toggleUser(${e.id})' />        </label>`}))}async function run(e){(getElementByClass(".iu_main-btn").style.display="none",getElementByClass(".iu_include-verified-checkbox")).disabled=!0,await getNonFollowersList(e)}function renderOverlay(){let e=!0;document.documentElement.style.backgroundColor="#222";const t=document.createElement("div"),n=(t.setAttribute("class","iu_overlay"),t.setAttribute("style",["background-color:#222","color:#fff","height:100%","font-family:system-ui"].join(";")),t.innerHTML="<header style='position:fixed;top:0;left:0;right:0;display:flex;align-items:center;justify-content:space-between;padding:1rem;height:2.5rem;background-color:#333;z-index:1;'>        <div style='font-family:monospace;font-size:1.5em;cursor:pointer;' onclick='location.reload()'>InstagramUnfollowers</div>        <label style='display:flex;cursor:pointer;'><input type='checkbox' class='iu_include-verified-checkbox' />&nbsp;Include verified</label>        <div class=\"progress-bar\" style=\"display:none; width: 120px;height: 30px;border-radius: 5px;margin: 20px 10px;border: 1px solid #7b7777;overflow: hidden;position: relative;\">\n            <span class=\"loading-percentage\" style=\"width: 0;height: 100%;display: block;color: white;line-height: 30px;position: absolute;text-align: end;padding-right: 5px;background-color: #7b7777;\">0%</span>\n        </div>\n        <div>Non-followers: <span class='iu_nonfollower-count' /></div>        <div style='font-size:1.2em;text-decoration:underline;color:red;cursor:pointer;' onclick='unfollow()'>Unfollow Selected <span class='iu_selected-count'>[0]</span></div>        <input type='checkbox' class='iu_toggle-all-checkbox' style='height:1.1rem;width:1.1rem;' onclick='toggleAllUsers(this.checked)' disabled />    </header>    <div class=\"sleeping\" style=\"position:fixed;top:55px;left:0;right:0;display:none;align-items:center;padding:0.7rem;height:1.7rem;background-color:#333;z-index:1;\">\n        <hr class=\"solid\" style=\"border-top: 1px solid #bbb;border-radius: 5px;width: 100%\">\n        <label class=\"sleeping-text\" style=\"color: red;margin-left: 16px;text-align: center\"></label>\n    </div>\n    <button class='iu_main-btn' style='position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);font-size:2em;cursor:pointer;height:160px;width:160px;border-radius:50%;background:transparent;color:currentColor;border:1px solid currentColor;'>RUN</button>    <div class='iu_results-container' style='transform:translateY(75px)'></div>",document.body.replaceChildren(t),getElementByClass(".iu_main-btn").addEventListener("click",(()=>run(e))),getElementByClass(".iu_include-verified-checkbox"));n.checked=e,n.addEventListener("change",(()=>e=!e))}async function getNonFollowersList(e=!0){if(getElementByClass(".progress-bar").style.display="block",!isActiveProcess){let n=[],o=!0,s=0,l=0,r=-1;isActiveProcess=!0;let i=`https://www.instagram.com/graphql/query/?query_hash=3dec7e2c57367ef3da3d987d89f9dbc8&variables={"id":"${getCookie("ds_user_id")}","include_reel":"true","fetch_mutual":"false","first":"24"}`;const a=getElementByClass(".loading-percentage"),d=getElementByClass(".iu_results-container"),c=getElementByClass(".iu_nonfollower-count");let u=getElementByClass(".sleeping"),g=getElementByClass(".sleeping-text");for(;o;){let f;try{f=await fetch(i).then((e=>e.json()))}catch(e){continue}-1===r&&(r=f.data.user.edge_follow.count),o=f.data.user.edge_follow.page_info.has_next_page,i=afterUrlGenerator(f.data.user.edge_follow.page_info.end_cursor),l+=f.data.user.edge_follow.edges.length,f.data.user.edge_follow.edges.forEach((t=>{!e&&t.node.is_verified||t.node.follows_viewer||n.push(t.node)}));var t=Math.round(l/r*100)+"%";a.innerHTML=t,a.style.width=t,d.innerHTML="",c.innerHTML=n.length.toString(),renderResults(n),await sleep(Math.floor(400*Math.random())+1e3),6<++s&&(s=0,u.style.display="inline-grid",g.innerHTML="Sleeping 10 secs to prevent getting temp blocked...",await sleep(1e4)),u.style.display="none"}a.style.backgroundColor="#59A942FF",a.innerHTML="DONE",a.style.textAlign="center",nonFollowersList=n,isActiveProcess=!1}}function init(){location.hostname!==INSTAGRAM_HOSTNAME?alert("Can be used only on Instagram routes"):(document.title="InstagramUnfollowers",renderOverlay())}window.addEventListener("beforeunload",(e=>{if(isActiveProcess)return(e=e||window.event)&&(e.returnValue="Changes you made may not be saved."),"Changes you made may not be saved."})),window.toggleUser=e=>{userIdsToUnfollow=-1===userIdsToUnfollow.indexOf(e)?[...userIdsToUnfollow,e]:userIdsToUnfollow.filter((t=>t!==e)),onToggleUser()},window.toggleAllUsers=(e=!1)=>{document.querySelectorAll("input.account-checkbox").forEach((t=>t.checked=e)),userIdsToUnfollow=e?nonFollowersList.map((e=>e.id)):[],onToggleUser()},window.unfollow=async()=>{if(!isActiveProcess&&confirm("Are you sure?")){var e=getCookie("csrftoken");if(void 0===e)throw new Error("csrftoken cookie is undefined");let o=getElementByClass(".sleeping"),s=getElementByClass(".sleeping-text");getElementByClass(".iu_toggle-all-checkbox").disabled=!0;const l=getElementByClass(".iu_results-container");l.innerHTML="";var t=()=>window.scrollTo(0,l.scrollHeight);isActiveProcess=!0;let r=0;for(const i of userIdsToUnfollow){var n=getUserById(i);try{await fetch(unfollowUserUrlGenerator(i),{headers:{"content-type":"application/x-www-form-urlencoded","x-csrftoken":e},method:"POST",mode:"cors",credentials:"include"}),l.innerHTML+=`<div style='padding:1rem;'>Unfollowed                <a style='color:inherit' target='_blank' href='www.instagram.com/${n.username}/'> ${n.username}</a>                <span style='color:#00ffff'> [${r+1}/${userIdsToUnfollow.length}]</span></div>`}catch(e){console.error(e),l.innerHTML+=`<div style='padding:1rem;color:red;'>Failed to unfollow ${n.username} [${r+1}/${userIdsToUnfollow.length}]</div>`}if(t(),await sleep(Math.floor(2e3*Math.random())+4e3),r+=1,i===userIdsToUnfollow[userIdsToUnfollow.length-1])break;r%5==0&&(o.style.display="inline-grid",s.innerHTML="Sleeping 5 minutes to prevent getting temp blocked...",t(),await sleep(3e5)),o.style.display="none"}isActiveProcess=!1,l.innerHTML+="<hr /><div style='padding:1rem;font-size:1.25em;color:#56d756;'>All DONE!</div><hr />",t()}},init();
